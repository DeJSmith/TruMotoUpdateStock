{"version":3,"sources":["img/TruMotoLogo.png","App.js","index.js"],"names":["App","state","setState","useState","shopifyFile","forbesFile","newStock","download","csvFile","downloadBtn","buttonClass","onChange","e","console","log","target","files","name","processFiles","async","forbes","process","shopify","stock","updateStock","JSON","parse","csv","convertToCSV","createBlob","file","Promise","resolve","reader","FileReader","onloadend","data","result","json","convertToJson","toString","split","readAsText","headers","i","length","obj","str","s","flag","ch","properties","j","includes","map","item","trim","push","stringify","products","stockNumbers","updatedStock","Number","product","String","SKU","row","Object","values","unshift","keys","join","replace","contentType","Blob","type","a","document","getElementById","href","window","URL","createObjectURL","dataset","downloadurl","className","src","Logo","alt","action","onSubmit","preventDefault","id","ReactDOM","render"],"mappings":"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","file":"static/js/main.88961e8b.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/TruMotoLogo.fe72b95d.png\";","import React, { useState } from \"react\";\nimport Logo from \"./img/TruMotoLogo.png\";\nimport \"./scss/index.scss\";\n\nconst App = () => {\n  const [state, setState] = useState({\n    shopifyFile: null,\n    forbesFile: null,\n    newStock: null,\n    download: null,\n    csvFile: null,\n    downloadBtn: true,\n    buttonClass: \"disabled\",\n  });\n\n  const onChange = (e) => {\n    console.log(e.target.files[0]);\n    setState({\n      ...state,\n      [e.target.name]: e.target.files[0],\n    });\n    //console.log(state);\n  };\n\n  const onSubmit = (e) => {\n    e.preventDefault();\n    console.log(\"submit\");\n    processFiles();\n  };\n\n  const processFiles = async () => {\n    let forbes = await process(state.forbesFile);\n    let shopify = await process(state.shopifyFile);\n    let stock = updateStock(JSON.parse(forbes), JSON.parse(shopify));\n    console.log(stock);\n    let csv = await convertToCSV(stock);\n    console.log(csv);\n    createBlob(csv);\n  };\n\n  const process = (file) => {\n    return new Promise((resolve) => {\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        var data = reader.result;\n        var json = convertToJson(data.toString().split(\"\\n\"));\n        console.log(json);\n\n        resolve(json);\n      };\n      reader.readAsText(file);\n    });\n  };\n\n  const convertToJson = (data) => {\n    console.log(\"converting to json\");\n    let result = [];\n    let headers = data[0].split(\",\");\n    //console.log(headers);\n\n    for (let i = 1; i < data.length - 1; i++) {\n      let obj = {};\n\n      let str = data[i];\n      let s = \"\";\n\n      let flag = 0;\n      for (let ch of str) {\n        if (ch === '\"' && flag === 0) {\n          flag = 1;\n        } else if (ch === '\"' && flag == 1) flag = 0;\n        if (ch === \",\" && flag === 0) ch = \"|\";\n        if (ch !== '\"') s += ch;\n      }\n\n      let properties = s.split(\"|\");\n      //console.log(properties);\n\n      for (let j in headers) {\n        if (properties[j].includes(\",\")) {\n          obj[headers[j]] = properties[j]\n            .split(\", \")\n            .map((item) => item.trim());\n        } else obj[headers[j]] = properties[j];\n      }\n      result.push(obj);\n      //console.log(result);\n    }\n    let json = JSON.stringify(result);\n    return json;\n  };\n\n  const updateStock = (newStock, products) => {\n    console.log(state);\n    let stockNumbers = {};\n    let updatedStock = [];\n    console.log(newStock[0]);\n\n    for (var item of newStock) {\n      stockNumbers[item[\"Item No.\"]] =\n        Number(item[\"Qty In Akl\"]) + Number(item[\"Qty In CH\"]);\n    }\n\n    for (var product of products) {\n      if (String(product.SKU) in stockNumbers) {\n        product[\"51 Waterloo Road\"] = stockNumbers[product.SKU];\n        updatedStock.push(product);\n      }\n    }\n\n    return updatedStock;\n  };\n\n  const convertToCSV = async (data) => {\n    console.log(data);\n    let csv = data.map((row) => Object.values(row));\n    csv.unshift(Object.keys(data[0]));\n    return `${csv.join(\"\\n\").replace(/,/g, \",\")}`;\n  };\n\n  const createBlob = (csv) => {\n    console.log(\"create blob\");\n    var contentType = \"text/csv;charset=utf-8;\";\n    var csvFile = new Blob([csv], { type: contentType });\n    console.log(csvFile);\n    var a = document.getElementById(\"download\");\n    a.download = \"updatedStock.csv\";\n    a.href = window.URL.createObjectURL(csvFile);\n    a.dataset.downloadurl = [contentType, a.download, a.href].join(\":\");\n    setState({\n      ...state,\n      buttonClass: \"\",\n    });\n  };\n\n  return (\n    <div className=\"my-container\">\n      <img src={Logo} alt=\"\" className=\"logo\" />\n      <div className=\"form-container\">\n        <form action=\"\" onSubmit={(e) => onSubmit(e)}>\n          <div className=\"form-group\">\n            <div className=\"form-group files\">\n              <label>Shopify CSV </label>\n              <input\n                type=\"file\"\n                className=\"form-control\"\n                name=\"shopifyFile\"\n                onChange={(e) => onChange(e)}\n              />\n            </div>\n\n            <div className=\"form-group files\">\n              <label>Forbes & Davies CSV </label>\n              <input\n                type=\"file\"\n                className=\"form-control\"\n                name=\"forbesFile\"\n                onChange={(e) => onChange(e)}\n              />\n            </div>\n          </div>\n\n          <div className=\"buttons-container\">\n            <button type=\"submit\" className=\"btn btn-primary mb-3\">\n              Submit\n            </button>\n            <a id=\"download\" className={`btn btn-primary ${state.buttonClass}`}>\n              Download Stock\n            </a>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}